<!--
 ____________________________________________________________
|                                                            |
|    DESIGN + Pat Heard { http://fullahead.org }             |
|      DATE + 2006.09.12                                     |
| COPYRIGHT + Free use if this notice is kept in place.      |
|____________________________________________________________|

-->

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>司徒的教學網站</title>
  <meta http-lowast="content-type" content="application/xhtml+xml; charset=UTF-8" />
  <meta name="author" content="fullahead.org" />
  <meta name="keywords" content="XHTML, CSS, template, FullAhead" />
  <meta name="description" content="A valid, XHTML 1.0 template" />
  <meta name="robots" content="index, follow, noarchive" />
  <meta name="googlebot" content="noarchive" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.1, maximum-scale=100.0"/>

  <link rel="shortcut icon" href="../../website.ico">
  <link rel="stylesheet" type="text/css" href="../../styles/shCore.css" />
  <link rel="stylesheet" type="text/css" href="../../styles/shThemeDefault.css" />
  <link rel="stylesheet" type="text/css" href="../../css/html.css" media="screen, projection, tv " />
  <link rel="stylesheet" type="text/css" href="../../css/layout.css" media="screen, projection, tv" />
  <link rel="stylesheet" type="text/css" href="../../css/print.css" media="print" />
  
  <script type="text/javascript" src="../../scripts/shCore.js"></script>
  <script type="text/javascript" src="../../scripts/shBrushCpp.js"></script>

  <!-- Conditional comment to apply opacity fix for IE #content background.
       Invalid CSS, but can be removed without harming design -->
  <!--[if gt IE 5]>
  <link rel="stylesheet" type="text/css" href="css/ie.css" media="screen, projection, tv " />
  <![endif]-->
</head>

<body>
<script type="text/javascript">SyntaxHighlighter.all();</script>
<div id="wrapper">
<div id="content">
<script type="text/javascript" src="../../header.js"></script>
<div id="page">
<h3>Sega Genesis</h3>
<p><b>檔頭資訊</b></p>
<hr size="1">
<p>
Ref. <a href="http://www.hacking-cult.org/?r/18/21">http://www.hacking-cult.org/?r/18/21</a><br>
Ref. <a href="https://github.com/ekeeke/Genesis-Plus-GX">https://github.com/ekeeke/Genesis-Plus-GX</a><br><br>

目前司徒知道的檔案副檔名類型，大致上有：*.smd、*.bin兩種，雖然副檔名可以隨意更改，不過一般模擬器還是會檢查檔案內部結構作為對應機制，Binary(*.bin)的檔頭資訊如下：
</p>

<table>
<tr><th>Offset</th><th>Description</th></tr>
<tr><td>0x00</td><td>Stack pointer</td></tr>
<tr><td>0x04</td><td>Code start</td></tr>
<tr><td>0x08</td><td>Bus error</td></tr>
<tr><td>0x0C</td><td>Address error</td></tr>
<tr><td>0x10</td><td>Illegal instruction</td></tr>
<tr><td>0x14</td><td>Divistion by zero</td></tr>
<tr><td>0x18</td><td>CHK exception</td></tr>
<tr><td>0x1C</td><td>TRAPV exception</td></tr>
<tr><td>0x20</td><td>Privilege violation</td></tr>
<tr><td>0x24</td><td>TRACE exeption</td></tr>  
<tr><td>0x28</td><td>LINE 1010 EMULATOR</td></tr>  
<tr><td>0x2C</td><td>LINE 1111 EMULATOR</td></tr>  
<tr><td>0x30-0x5F</td><td>Reserved by Motorola</td></tr>  
<tr><td>0x60</td><td>Spurious exception</td></tr> 
<tr><td>0x64</td><td>Interrupt request level 1</td></tr>  
<tr><td>0x68</td><td>Interrupt request level 2</td></tr>  
<tr><td>0x6C</td><td>Interrupt request level 3</td></tr>  
<tr><td>0x70</td><td>Interrupt request level 4 (VDP interrupt / Horizontal blank)</td></tr>  
<tr><td>0x74</td><td>Interrupt request level 5</td></tr>  
<tr><td>0x78</td><td>Interrupt request level 6 (Vertical blank)</td></tr>  
<tr><td>0x7C</td><td>Interrupt request level 7</td></tr>  
<tr><td>0x80</td><td>TRAP #00 exception</td></tr>  
<tr><td>0x84</td><td>TRAP #01 exception</td></tr>  
<tr><td>0x88</td><td>TRAP #02 exception</td></tr>  
<tr><td>0x8C</td><td>TRAP #03 exception</td></tr>  
<tr><td>0x90</td><td>TRAP #04 exception</td></tr>  
<tr><td>0x94</td><td>TRAP #05 exception</td></tr>  
<tr><td>0x98</td><td>TRAP #06 exception</td></tr>  
<tr><td>0x9C</td><td>TRAP #07 exception</td></tr>  
<tr><td>0xA0</td><td>TRAP #08 exception</td></tr>  
<tr><td>0xA4</td><td>TRAP #09 exception</td></tr>  
<tr><td>0xA8</td><td>TRAP #10 exception</td></tr>  
<tr><td>0xAC</td><td>TRAP #11 exception</td></tr>  
<tr><td>0xB0</td><td>TRAP #12 exception</td></tr>  
<tr><td>0xB4</td><td>TRAP #13 exception</td></tr>  
<tr><td>0xB8</td><td>TRAP #14 exception</td></tr>  
<tr><td>0xBC</td><td>TRAP #15 exception</td></tr>  
<tr><td>0xC0-0xFF</td><td>Reserved by Motorola</td></tr>
<tr><td>0x100-0x10F</td><td>Console name (usually 'SEGA MEGA DRIVE ' or 'SEGA GENESIS    ')</td></tr>
<tr><td>0x110-0x11F</td><td>Release date (usually '(C)XXXX YYYY.MMM' where XXXX is the company code, YYYY is the year and MMM is the month)</td></tr>
<tr><td>0x120-0x14F</td><td>Domestic name</td></tr>
<tr><td>0x150-0x17F</td><td>International name</td></tr>
<tr><td>0x180-0x18D</td><td>Version ('XX YYYYYYYYYYYY' where XX is the game type and YY the game code)</td></tr>
<tr><td>0x18E-0x18F</td><td>Checksum (for info how to calculate checksum go HERE)</td></tr>
<tr><td>0x190-0x19F</td><td>I/O support</td></tr>
<tr><td>0x1A0-0x1A3</td><td>ROM start</td></tr> 
<tr><td>0x1A4-0x1A7</td><td>ROM end</td></tr>
<tr><td>0x1A8-0x1AB</td><td>RAM start (usually 0x00FF0000)</td></tr>
<tr><td>0x1AC-0x1AF</td><td>RAM end (usually 0x00FFFFFF)</td></tr>
<tr><td>0x1B0-0x1B2</td><td>'RA' and 0xF8 enables SRAM.</td></tr>
<tr><td>0x1B3</td><td>unused (0x20)</td></tr>
<tr><td>0x1B4-0x1B7</td><td>SRAM start (default 0x00200000)</td></tr>
<tr><td>0x1B8-0x1BB</td><td>SRAM end (default 0x0020FFFF)</td></tr>
<tr><td>0x1BC-0x1FF</td><td>Notes (unused)</td></tr>
<table><br>

<p>
因此，如果不是這個格式的檔案，基本上是可以看成SMD(*.smd)類型的檔案，但是這樣說明好像有點粗糙，因此，司徒追了一下Genesis-Plus-GX模擬器，並且把載入ROM的步驟列出來：<br>
Step1. 檢查0x100的位置是否為<b>"ESAG"</b>，假如是，則必須做Endian交換(byte-swapped)，其實就是高低Byte互換的意思<br>
Step2. 檢查0x100的位置是否為<b>"SEGA"</b>，假如不是，則代表SMD檔案類型，必須做de-interleave的動作，也就是前後8K Bytes互換<br>
Step3. 接著載入處理完的檔案(Binary)
</p>

<p>
<br><br><a href="../../emu.htm">返回上一頁</a>
</p>

</div>
</div>
</div>
</body>
</html>
