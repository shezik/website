<!--
 ____________________________________________________________
|                                                            |
|    DESIGN + Pat Heard { http://fullahead.org }             |
|      DATE + 2006.09.12                                     |
| COPYRIGHT + Free use if this notice is kept in place.      |
|____________________________________________________________|

-->

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>司徒的教學網站</title>
  <meta http-lowast="content-type" content="application/xhtml+xml; charset=UTF-8" />
  <meta name="author" content="fullahead.org" />
  <meta name="keywords" content="XHTML, CSS, template, FullAhead" />
  <meta name="description" content="A valid, XHTML 1.0 template" />
  <meta name="robots" content="index, follow, noarchive" />
  <meta name="googlebot" content="noarchive" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.1, maximum-scale=100.0"/>

  <link rel="shortcut icon" href="../../website.ico">
  <link rel="stylesheet" type="text/css" href="../../styles/shCore.css" />
  <link rel="stylesheet" type="text/css" href="../../styles/shThemeDefault.css" />
  <link rel="stylesheet" type="text/css" href="../../css/html.css" media="screen, projection, tv " />
  <link rel="stylesheet" type="text/css" href="../../css/layout.css" media="screen, projection, tv" />
  <link rel="stylesheet" type="text/css" href="../../css/print.css" media="print" />
  
  <script type="text/javascript" src="../../scripts/shCore.js"></script>
  <script type="text/javascript" src="../../scripts/shBrushAsm.js"></script>

  <!-- Conditional comment to apply opacity fix for IE #content background.
       Invalid CSS, but can be removed without harming design -->
  <!--[if gt IE 5]>
  <link rel="stylesheet" type="text/css" href="css/ie.css" media="screen, projection, tv " />
  <![endif]-->
</head>

<body>
<script type="text/javascript">SyntaxHighlighter.all();</script>
<div id="wrapper">
<div id="content">
<script type="text/javascript" src="../../header.js"></script>
<div id="page">
<h3>FASM &gt;&gt; Assembly (x86) &gt;&gt; Win32 API</h3>
<p><b>Hello, world!</b></p>
<hr size="1">
<p>
參考資訊：<br>
1. <a href="https://board.flatassembler.net/">fasm</a><br><br>

main.asm
</p>
<pre class="brush:asm">
    format PE GUI 4.0
    entry start

    include "c:\fasm\include\win32a.inc"

    section ".idata" import data readable writeable
library user, "user32.dll", kernel, "kernel32.dll"

import user,   MessageBox,  "MessageBoxA"
import kernel, ExitProcess, "ExitProcess"

    section ".data" data readable writeable
szCaption db "main",0
szContent db "Hello, world!",0

    section ".text" code readable executable
start:
    invoke MessageBox, NULL, szContent, szCaption, MB_OK
    invoke ExitProcess, 0
</pre>
<p>
<b>Line 1</b>：執行檔的格式<br>
<b>Line 2</b>：程式的進入點<br>
<b>Line 4</b>：Header檔案<br>
<b>Line 6</b>：Import區段<br>
<b>Line 7</b>：使用到的Library<br>
<b>Line 9~10</b>：使用到的Win32 API<br>
<b>Line 12</b>：初始化的資料區段<br>
<b>Line 13~14</b>：初始化的Global變數，型態是byte(char)且最後一個byte是0<br>
<b>Line 16</b>：程式區段<br>
<b>Line 17</b>：程式的進入點<br>
<b>Line 18</b>：顯示Message對話盒，invoke其實就是call + push的綜合指令<br>
<b>Line 19</b>：結束Process並且釋放相關資源<br><br>

Makefile
</p>
<pre>
export WINEPREFIX=/home/user/.wine_amd64

TARGET=main
MYWINE=box86 wine
FASM32=/home/user/.wine_amd64/drive_c/fasm

all:
    ${MYWINE} ${FASM32}/fasm.exe ${TARGET}.asm

run:
    ${MYWINE} ${TARGET}.exe

clean:
    rm -rf ${TARGET}.exe
</pre><br>

<p>
編譯、執行
</p>
<pre>
$ make
$ make run
</pre>
<p>
<img style="border:0px" style="border:0px" src="win32_hello/1.jpg" class="maxSize">
</p>

<p>
<br><a href="../../program.htm">返回上一頁</a>
</p>

</div>
</div>
</div>
</body>
</html>
